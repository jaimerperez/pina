{"version":3,"file":"tiptap-extension-mention.umd.js","sources":["../src/mention.ts"],"sourcesContent":["import { Node, mergeAttributes } from '@tiptap/core'\nimport { Node as ProseMirrorNode } from 'prosemirror-model'\nimport Suggestion, { SuggestionOptions } from '@tiptap/suggestion'\n\nexport type MentionOptions = {\n  HTMLAttributes: Record<string, any>,\n  renderLabel: (props: {\n    options: MentionOptions,\n    node: ProseMirrorNode,\n  }) => string,\n  suggestion: Omit<SuggestionOptions, 'editor'>,\n}\n\nexport const Mention = Node.create<MentionOptions>({\n  name: 'mention',\n\n  defaultOptions: {\n    HTMLAttributes: {},\n    renderLabel({ options, node }) {\n      return `${options.suggestion.char}${node.attrs.label ?? node.attrs.id}`\n    },\n    suggestion: {\n      char: '@',\n      command: ({ editor, range, props }) => {\n        editor\n          .chain()\n          .focus()\n          .insertContentAt(range, [\n            {\n              type: 'mention',\n              attrs: props,\n            },\n            {\n              type: 'text',\n              text: ' ',\n            },\n          ])\n          .run()\n      },\n      allow: ({ editor, range }) => {\n        return editor.can().insertContentAt(range, { type: 'mention' })\n      },\n    },\n  },\n\n  group: 'inline',\n\n  inline: true,\n\n  selectable: false,\n\n  atom: true,\n\n  addAttributes() {\n    return {\n      id: {\n        default: null,\n        parseHTML: element => {\n          return {\n            id: element.getAttribute('data-id'),\n          }\n        },\n        renderHTML: attributes => {\n          if (!attributes.id) {\n            return {}\n          }\n\n          return {\n            'data-id': attributes.id,\n          }\n        },\n      },\n\n      label: {\n        default: null,\n        parseHTML: element => {\n          return {\n            label: element.getAttribute('data-label'),\n          }\n        },\n        renderHTML: attributes => {\n          if (!attributes.label) {\n            return {}\n          }\n\n          return {\n            'data-label': attributes.label,\n          }\n        },\n      },\n    }\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'span[data-mention]',\n      },\n    ]\n  },\n\n  renderHTML({ node, HTMLAttributes }) {\n    return [\n      'span',\n      mergeAttributes({ 'data-mention': '' }, this.options.HTMLAttributes, HTMLAttributes),\n      this.options.renderLabel({\n        options: this.options,\n        node,\n      }),\n    ]\n  },\n\n  renderText({ node }) {\n    return this.options.renderLabel({\n      options: this.options,\n      node,\n    })\n  },\n\n  addKeyboardShortcuts() {\n    return {\n      Backspace: () => this.editor.commands.command(({ tr, state }) => {\n        let isMention = false\n        const { selection } = state\n        const { empty, anchor } = selection\n\n        if (!empty) {\n          return false\n        }\n\n        state.doc.nodesBetween(anchor - 1, anchor, (node, pos) => {\n          if (node.type.name === this.name) {\n            isMention = true\n            tr.insertText(this.options.suggestion.char || '', pos, pos + node.nodeSize)\n\n            return false\n          }\n        })\n\n        return isMention\n      }),\n    }\n  },\n\n  addProseMirrorPlugins() {\n    return [\n      Suggestion({\n        editor: this.editor,\n        ...this.options.suggestion,\n      }),\n    ]\n  },\n})\n"],"names":["Node","mergeAttributes","Suggestion"],"mappings":"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"}