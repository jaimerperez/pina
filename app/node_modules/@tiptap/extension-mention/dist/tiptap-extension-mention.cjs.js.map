{"version":3,"file":"tiptap-extension-mention.cjs.js","sources":["../src/mention.ts"],"sourcesContent":["import { Node, mergeAttributes } from '@tiptap/core'\nimport { Node as ProseMirrorNode } from 'prosemirror-model'\nimport Suggestion, { SuggestionOptions } from '@tiptap/suggestion'\n\nexport type MentionOptions = {\n  HTMLAttributes: Record<string, any>,\n  renderLabel: (props: {\n    options: MentionOptions,\n    node: ProseMirrorNode,\n  }) => string,\n  suggestion: Omit<SuggestionOptions, 'editor'>,\n}\n\nexport const Mention = Node.create<MentionOptions>({\n  name: 'mention',\n\n  defaultOptions: {\n    HTMLAttributes: {},\n    renderLabel({ options, node }) {\n      return `${options.suggestion.char}${node.attrs.label ?? node.attrs.id}`\n    },\n    suggestion: {\n      char: '@',\n      command: ({ editor, range, props }) => {\n        editor\n          .chain()\n          .focus()\n          .insertContentAt(range, [\n            {\n              type: 'mention',\n              attrs: props,\n            },\n            {\n              type: 'text',\n              text: ' ',\n            },\n          ])\n          .run()\n      },\n      allow: ({ editor, range }) => {\n        return editor.can().insertContentAt(range, { type: 'mention' })\n      },\n    },\n  },\n\n  group: 'inline',\n\n  inline: true,\n\n  selectable: false,\n\n  atom: true,\n\n  addAttributes() {\n    return {\n      id: {\n        default: null,\n        parseHTML: element => {\n          return {\n            id: element.getAttribute('data-id'),\n          }\n        },\n        renderHTML: attributes => {\n          if (!attributes.id) {\n            return {}\n          }\n\n          return {\n            'data-id': attributes.id,\n          }\n        },\n      },\n\n      label: {\n        default: null,\n        parseHTML: element => {\n          return {\n            label: element.getAttribute('data-label'),\n          }\n        },\n        renderHTML: attributes => {\n          if (!attributes.label) {\n            return {}\n          }\n\n          return {\n            'data-label': attributes.label,\n          }\n        },\n      },\n    }\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'span[data-mention]',\n      },\n    ]\n  },\n\n  renderHTML({ node, HTMLAttributes }) {\n    return [\n      'span',\n      mergeAttributes({ 'data-mention': '' }, this.options.HTMLAttributes, HTMLAttributes),\n      this.options.renderLabel({\n        options: this.options,\n        node,\n      }),\n    ]\n  },\n\n  renderText({ node }) {\n    return this.options.renderLabel({\n      options: this.options,\n      node,\n    })\n  },\n\n  addKeyboardShortcuts() {\n    return {\n      Backspace: () => this.editor.commands.command(({ tr, state }) => {\n        let isMention = false\n        const { selection } = state\n        const { empty, anchor } = selection\n\n        if (!empty) {\n          return false\n        }\n\n        state.doc.nodesBetween(anchor - 1, anchor, (node, pos) => {\n          if (node.type.name === this.name) {\n            isMention = true\n            tr.insertText(this.options.suggestion.char || '', pos, pos + node.nodeSize)\n\n            return false\n          }\n        })\n\n        return isMention\n      }),\n    }\n  },\n\n  addProseMirrorPlugins() {\n    return [\n      Suggestion({\n        editor: this.editor,\n        ...this.options.suggestion,\n      }),\n    ]\n  },\n})\n"],"names":["Node","mergeAttributes","Suggestion"],"mappings":"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"}